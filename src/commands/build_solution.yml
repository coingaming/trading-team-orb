description: >
  Builds target solution
parameters:
  solution_path:
    type: string
  sonarscanner_project_key:
    type: string
steps:
  - run:
      name: "Building solution"
      command: |
        apt-get update && apt-get install -y openjdk-11-jdk
        dotnet tool install --global dotnet-sonarscanner
        dotnet tool install --global coverlet.console
        export PATH="$PATH:/root/.dotnet/tools"
        dotnet sonarscanner begin /k:"<<parameters.sonarscanner_project_key>>" /d:sonar.login=$SONAR_TOKEN /d:sonar.host.url=https://sonarcloud.io /o:"coingaming" /d:sonar.verbose=true
        dotnet build
        dotnet sonarscanner end /d:sonar.login=$SONAR_TOKEN
        dotnet publish <<parameters.solution_path>> -c Release -o app/out
        rm -rf build
